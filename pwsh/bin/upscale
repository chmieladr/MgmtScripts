#!/usr/bin/pwsh
# Script made by Adrian Chmiel (chmieladr)
# Upscales all the provided videos to 3840x2160 resolution

# Check if the user provided any input files
if [ $# -eq 0 ]; then
    echo "No input files provided!"
    echo "Usage: $0 <input_file1> <input_file2> ..."
    exit 1
fi

# Create a new directory for the upscaled videos
mkdir -p upscaled

for input_file in "$@"; do
    # Redirect the output to the created directory
    output_file="upscaled/$(basename "$input_file")"

    # Upscale the video to 3840x2160 resolution using the NVIDIA NVENC encoder
    ffmpeg -i "$input_file" -vf scale=3840:2160:flags=neighbor -c:v h264_nvenc -profile high -preset slow -rc vbr_2pass -qmin 17 -qmax 22 -2pass 1 -c:a:0 copy -b:a 384k "$output_file"

    # Confirmation message
    if [ !$? ]; then
        echo "The video $(basename "$input_file") has been successfully upscaled!"
    else
        echo "An error occurred while upscaling the video $(basename "$input_file")!"
    fi
done